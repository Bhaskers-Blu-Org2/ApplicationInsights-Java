<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration>
<configuration>
    <appender name="CONSOLE" class="com.microsoft.applicationinsights.agent.shadow.ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSSX} %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- site.logdir output -->
    <appender name="LOGDIR" class="com.microsoft.applicationinsights.agent.shadow.ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${site.logdir:-/home/LogFiles}/ApplicationInsights/application-insights-extension.log</file>
        <rollingPolicy class="com.microsoft.applicationinsights.agent.shadow.ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${site.logdir:-/home/LogFiles}/ApplicationInsights/application-insights-extension-%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <maxHistory>7</maxHistory>
            <totalSizeCap>5MB</totalSizeCap>
            <maxFileSize>3MB</maxFileSize>
        </rollingPolicy>
        <encoder class="com.microsoft.applicationinsights.agent.shadow.ch.qos.logback.core.encoder.LayoutWrappingEncoder">
            <layout class="com.microsoft.applicationinsights.agent.bootstrap.diagnostics.log.ApplicationInsightsJsonLayout">
                <timestampFormat>yyyy-MM-dd'T'HH:mm:ss.SSSX</timestampFormat>
                <timestampFormatTimezoneId>Etc/UTC</timestampFormatTimezoneId>
                <appendLineSeparator>true</appendLineSeparator>
                <jsonFormatter class="com.microsoft.applicationinsights.agent.bootstrap.diagnostics.log.MoshiJsonFormatter">
                    <prettyPrint>false</prettyPrint>
                </jsonFormatter>
            </layout>
        </encoder>
    </appender>

    <!-- troubleshooting logs -->
    <appender name="APPSVCTBS" class="com.microsoft.applicationinsights.agent.shadow.ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="com.microsoft.applicationinsights.agent.bootstrap.diagnostics.log.ApplicationInsightsDiagnosticsLogFilter"/>
        <file>/var/log/applicationinsights/application-insights-extension.log</file>
        <rollingPolicy class="com.microsoft.applicationinsights.agent.shadow.ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>/var/log/applicationinsights/application-insights-extension-%d{yyyy-MM-dd}.%i.log.old</fileNamePattern>
            <maxHistory>1</maxHistory>
            <totalSizeCap>10MB</totalSizeCap>
            <maxFileSize>5MB</maxFileSize>
        </rollingPolicy>
        <encoder class="com.microsoft.applicationinsights.agent.shadow.ch.qos.logback.core.encoder.LayoutWrappingEncoder">
            <layout class="com.microsoft.applicationinsights.agent.bootstrap.diagnostics.log.ApplicationInsightsJsonLayout">
                <timestampFormat>yyyy-MM-dd'T'HH:mm:ss.SSSX</timestampFormat>
                <timestampFormatTimezoneId>Etc/UTC</timestampFormatTimezoneId>
                <appendLineSeparator>true</appendLineSeparator>
                <jsonFormatter class="com.microsoft.applicationinsights.agent.bootstrap.diagnostics.log.MoshiJsonFormatter">
                    <prettyPrint>false</prettyPrint>
                </jsonFormatter>
            </layout>
        </encoder>
    </appender>

    <!-- never want to log apache http at trace or debug, it's just way to verbose -->
    <logger name="org.apache.http" level="${applicationinsights.logback.level.org.apache.http}" />
    <root level="${applicationinsights.logback.level}">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="LOGDIR"/>
        <appender-ref ref="APPSVCTBS"/>
    </root>

    <logger name="applicationinsights.diagnostics" level="info" />
</configuration>
